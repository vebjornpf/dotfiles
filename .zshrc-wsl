# Safety: don't clobber files with ">"
set -o noclobber
setopt NO_BEEP
export PATH=/home/linuxbrew/.linuxbrew/bin:$HOME/bin:$HOME/.local/bin:/usr/local/bin:$PATH
export EDITOR=nvim
export VISUAL=nvim
# Path to your Oh My Zsh installation.
export ZSH="$HOME/.oh-my-zsh"
# Set name of the theme to load --- if set to "random", it will
# load a random theme each time Oh My Zsh is loaded, in which case,
# to know which specific one was loaded, run: echo $RANDOM_THEME
# See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes
ZSH_THEME="catppuccin"
CATPPUCCIN_FLAVOR="macchiato"

plugins=(git gradle z zsh-autosuggestions zsh-syntax-highlighting)


export GCP_OAUTH_TOKEN="$(gcloud auth print-access-token 2>/dev/null)"
#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"

browse() {
  local dir="${1:-.}"

  # Use fd if available (faster), else fallback to find
  local list_cmd
  if command -v fd >/dev/null 2>&1; then
    list_cmd="fd . $dir"
  else
    list_cmd="find \"$dir\" -mindepth 1"
  fi

  eval "$list_cmd" | fzf \
    --ansi \
    --height=90% \
    --layout=reverse \
    --border \
    --preview '([[ -d {} ]] && ls --color=always -la {} || bat --style=numbers --color=always {}) 2>/dev/null' \
    --preview-window=right:60%:wrap \
    --bind 'ctrl-d:preview-page-down,ctrl-u:preview-page-up' \
    --bind 'enter:execute(${EDITOR:-nvim} {} > /dev/tty < /dev/tty)+abort'
}

endpoints() {
  # Look for OpenAPI spec in current directory
  local file=""
  file=$(find . -type f \( -name "openapi.yaml" -o -name "openapi.yml" -o -name "openapi.json" \) \
         2>/dev/null | fzf --prompt="Select OpenAPI spec > " --height=40% --border --layout=reverse) || return

  # Handle missing file
  if [[ -z "$file" ]]; then
    echo "âŒ No OpenAPI spec found (expected openapi.yaml|yml|json)"
    return 1
  fi

  echo "ğŸ“˜ Using OpenAPI spec: $file"
  echo "----------------------------------------"
  yq -r '.paths | to_entries[] | .key as $path | .value | to_entries[] | "\(.key) \($path)"' "$file"
}

source $ZSH/oh-my-zsh.sh
